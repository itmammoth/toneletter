(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["Toneletter"] = factory();
	else
		root["Toneletter"] = factory();
})(this, function() {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/***/ ((module) => {

module.exports = JSON.parse('{"name":"toneletter","version":"2.0.4","description":"A javascript plugin that allows you to put phonetic/tone symbols into text field.","main":"dist/toneletter.min.js","scripts":{"start":"webpack serve","test":"jest","build":"webpack; cp dist/toneletter.min.js docs/js/","publish":"npm run build & npm publish ./"},"repository":{"type":"git","url":"git+https://github.com/itmammoth/toneletter.git"},"author":"itmammoth@gmail.com","license":"MIT","bugs":{"url":"https://github.com/itmammoth/toneletter/issues"},"homepage":"https://github.com/itmammoth/toneletter#readme","devDependencies":{"@babel/core":"^7.16.5","@babel/preset-env":"^7.16.5","babel-loader":"^8.2.3","jest":"^27.4.4","uglify-js":"^3.14.5","webpack":"^5.65.0","webpack-cli":"^4.9.1","webpack-dev-server":"^4.6.0"}}');

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
/*!***************************!*\
  !*** ./src/toneletter.js ***!
  \***************************/
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Toneletter)
/* harmony export */ });
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var packageJson = __webpack_require__(/*! ../package.json */ "./package.json");

var LANG_SETTINGS = Object.freeze({
  th: {
    phoneticSymbols: {
      W: "\u0289",
      // ʉ
      U: "\u0259",
      // ə
      E: "\u025b",
      // ɛ
      O: "\u0254",
      // ɔ
      N: "\u014b" // ŋ

    },
    // tone 1 (ā), tone 2 (à), tone 3 (â), tone 4 (á), tone 5 (ǎ)
    toneKeys: ["1", "2", "3", "4", "5"]
  },
  cn: {
    phoneticSymbols: {
      U: "\u00FC" //ü

    },
    // tone 1 (ā), tone 2 (à), tone 3 (â), tone 4 (á), tone 5 (ǎ)
    toneKeys: ["1", "4", null, "2", "3"]
  }
});
var TONE_CONVERT_TABLE = Object.freeze({
  // i
  "\u0069": ["\u012B", "\u00EC", "\u00EE", "\u00ED", "\u01D0"],
  // e
  "\u0065": ["\u0113", "\u00E8", "\u00EA", "\u00E9", "\u011B"],
  // ɛ
  "\u025B": ["\u025B\u0304", "\u025B\u0300", "\u025B\u0302", "\u025B\u0301", "\u025B\u030C"],
  // ʉ
  "\u0289": ["\u0289\u0304", "\u0289\u0300", "\u0289\u0302", "\u0289\u0301", "\u0289\u030C"],
  // ə
  "\u0259": ["\u0259\u0304", "\u0259\u0300", "\u0259\u0302", "\u0259\u0301", "\u0259\u030C"],
  // a
  "\u0061": ["\u0101", "\u00E0", "\u00E2", "\u00E1", "\u01CE"],
  // u
  "\u0075": ["\u016B", "\u00F9", "\u00FB", "\u00FA", "\u01D4"],
  // o
  "\u006F": ["\u014D", "\u00F2", "\u00F4", "\u00F3", "\u01D2"],
  // ɔ
  "\u0254": ["\u0254\u0304", "\u0254\u0300", "\u0254\u0302", "\u0254\u0301", "\u0254\u030C"],
  // ü
  "\u00FC": ["\u01D6", "\u01DC", "", "\u01D8", "\u01DA"]
});
var TONE_SYMBOLS = Object.freeze(["\u0304", "\u0300", "\u0302", "\u0301", "\u030C"]);
class Toneletter {
  constructor(inputElement) {
    var _settings$phoneticSym, _settings$toneKeys;

    var settings = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      lang: "",
      phoneticSymbols: null,
      toneKeys: null
    };

    if (!inputElement) {
      throw new Error("`inputElement` must be given");
    }

    if (settings.lang === "") {
      throw new Error("`settings.lang` must be given");
    }

    if (!["th", "cn"].includes(settings.lang)) {
      throw new Error("`settings.lang` must be 'th' or 'cn'");
    }

    this.inputElement = inputElement;
    var phoneticSymbols = (_settings$phoneticSym = settings.phoneticSymbols) !== null && _settings$phoneticSym !== void 0 ? _settings$phoneticSym : LANG_SETTINGS[settings.lang].phoneticSymbols;
    var toneKeys = (_settings$toneKeys = settings.toneKeys) !== null && _settings$toneKeys !== void 0 ? _settings$toneKeys : LANG_SETTINGS[settings.lang].toneKeys;
    this.__keyToCallbacks = _objectSpread(_objectSpread({}, this.__createPhoneticSymbolCallbacks(phoneticSymbols)), this.__createToneCallbacks(toneKeys));
  }

  static get version() {
    return packageJson.version;
  }

  observe() {
    this.__onKeyDown.__bound = e => this.__onKeyDown(e);

    this.inputElement.addEventListener("keydown", this.__onKeyDown.__bound);
  }

  off() {
    this.inputElement.removeEventListener("keydown", this.__onKeyDown.__bound);
  }

  addTone(toneNumber, pressedKey) {
    if (this.__isConvertable(this.__previousCharacter)) {
      this.__insertTone(this.__convertToTone(toneNumber));
    } else if (pressedKey) {
      this.__insert(pressedKey);
    }
  }

  __createPhoneticSymbolCallbacks(phoneticSymbols) {
    return Object.entries(phoneticSymbols).reduce((accum, _ref) => {
      var [key, symbol] = _ref;

      accum[key] = () => {
        this.__insert(symbol);
      };

      return accum;
    }, {});
  }

  __createToneCallbacks(toneKeys) {
    return toneKeys.reduce((accum, key, i) => {
      if (key) {
        accum[key] = () => {
          this.addTone(i, key);
        };
      }

      return accum;
    }, {});
  }

  __onKeyDown(e) {
    var callback = this.__keyToCallbacks[e.key];

    if (callback) {
      callback();
      e.preventDefault();
      return;
    }
  }

  __insert(text) {
    var at = this.__cursorPosition;
    this.inputElement.value = this.inputElement.value.slice(0, at) + text + this.inputElement.value.slice(at);

    this.__setCursor(at + text.length);
  }

  __insertTone(tone) {
    this.__backspace();

    this.__insert(tone);
  }

  __backspace() {
    var from = this.__cursorPosition;

    var length = this.__calcBSLength(from, this.__previousCharacter);

    this.inputElement.value = this.inputElement.value.slice(0, from - length) + this.inputElement.value.slice(from);

    this.__setCursor(from - length);
  }

  __calcBSLength(position, character) {
    return this.inputElement.value.substring(0, position).split("").reverse().map(this.__removeTone).indexOf(character) + 1;
  }

  get __cursorPosition() {
    return this.inputElement.selectionEnd;
  }

  get __previousCharacter() {
    var position = this.__cursorPosition;
    var prevChar = this.inputElement.value.charAt(position - 1);
    if (prevChar === "") return prevChar; // Skip if the previous character is just a tone symbol

    if (this.__isTone(prevChar)) {
      return this.inputElement.value.charAt(position - 2);
    }

    return this.__removeTone(prevChar);
  }

  __setCursor(position) {
    this.inputElement.focus();
    this.inputElement.selectionStart = this.inputElement.selectionEnd = position;
  }

  __isTone(character) {
    return TONE_SYMBOLS.indexOf(character) > -1;
  }

  __isConvertable(character) {
    return TONE_CONVERT_TABLE[character] !== undefined;
  }

  __convertToTone(toneNumber) {
    return TONE_CONVERT_TABLE[this.__previousCharacter][toneNumber];
  }

  __removeTone(character) {
    for (var vowel in TONE_CONVERT_TABLE) {
      if (TONE_CONVERT_TABLE[vowel].indexOf(character) > -1) {
        return vowel;
      }
    }

    return character;
  }

}
})();

__webpack_exports__ = __webpack_exports__["default"];
/******/ 	return __webpack_exports__;
/******/ })()
;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBVyxDQUFDTSxRQUFELEVBQVc7QUFDcEIsU0FBSzNDLFlBQUwsQ0FBa0J1RCxLQUFsQjtBQUNBLFNBQUt2RCxZQUFMLENBQWtCd0QsY0FBbEIsR0FBbUMsS0FBS3hELFlBQUwsQ0FBa0JtRCxZQUFsQixHQUNqQ1IsUUFERjtBQUVEOztBQUVEVyxFQUFBQSxRQUFRLENBQUNWLFNBQUQsRUFBWTtBQUNsQixXQUFPL0MsWUFBWSxDQUFDcUQsT0FBYixDQUFxQk4sU0FBckIsSUFBa0MsQ0FBQyxDQUExQztBQUNEOztBQUVEekIsRUFBQUEsZUFBZSxDQUFDeUIsU0FBRCxFQUFZO0FBQ3pCLFdBQU9oRCxrQkFBa0IsQ0FBQ2dELFNBQUQsQ0FBbEIsS0FBa0NhLFNBQXpDO0FBQ0Q7O0FBRURuQyxFQUFBQSxlQUFlLENBQUNMLFVBQUQsRUFBYTtBQUMxQixXQUFPckIsa0JBQWtCLENBQUMsS0FBS3dCLG1CQUFOLENBQWxCLENBQTZDSCxVQUE3QyxDQUFQO0FBQ0Q7O0FBRURnQyxFQUFBQSxZQUFZLENBQUNMLFNBQUQsRUFBWTtBQUN0QixTQUFLLElBQU1jLEtBQVgsSUFBb0I5RCxrQkFBcEIsRUFBd0M7QUFDdEMsVUFBSUEsa0JBQWtCLENBQUM4RCxLQUFELENBQWxCLENBQTBCUixPQUExQixDQUFrQ04sU0FBbEMsSUFBK0MsQ0FBQyxDQUFwRCxFQUF1RDtBQUNyRCxlQUFPYyxLQUFQO0FBQ0Q7QUFDRjs7QUFDRCxXQUFPZCxTQUFQO0FBQ0Q7O0FBcko2QixDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vVG9uZWxldHRlci93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vVG9uZWxldHRlci93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Ub25lbGV0dGVyL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9Ub25lbGV0dGVyL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vVG9uZWxldHRlci93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL1RvbmVsZXR0ZXIvLi9zcmMvdG9uZWxldHRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJUb25lbGV0dGVyXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlRvbmVsZXR0ZXJcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImNvbnN0IHBhY2thZ2VKc29uID0gcmVxdWlyZShcIi4uL3BhY2thZ2UuanNvblwiKTtcblxuY29uc3QgTEFOR19TRVRUSU5HUyA9IE9iamVjdC5mcmVlemUoe1xuICB0aDoge1xuICAgIHBob25ldGljU3ltYm9sczoge1xuICAgICAgVzogXCJcXHUwMjg5XCIsIC8vIMqJXG4gICAgICBVOiBcIlxcdTAyNTlcIiwgLy8gyZlcbiAgICAgIEU6IFwiXFx1MDI1YlwiLCAvLyDJm1xuICAgICAgTzogXCJcXHUwMjU0XCIsIC8vIMmUXG4gICAgICBOOiBcIlxcdTAxNGJcIiwgLy8gxYtcbiAgICB9LFxuICAgIC8vIHRvbmUgMSAoxIEpLCB0b25lIDIgKMOgKSwgdG9uZSAzICjDoiksIHRvbmUgNCAow6EpLCB0b25lIDUgKMeOKVxuICAgIHRvbmVLZXlzOiBbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiXSxcbiAgfSxcbiAgY246IHtcbiAgICBwaG9uZXRpY1N5bWJvbHM6IHtcbiAgICAgIFU6IFwiXFx1MDBGQ1wiLCAvL8O8XG4gICAgfSxcbiAgICAvLyB0b25lIDEgKMSBKSwgdG9uZSAyICjDoCksIHRvbmUgMyAow6IpLCB0b25lIDQgKMOhKSwgdG9uZSA1ICjHjilcbiAgICB0b25lS2V5czogW1wiMVwiLCBcIjRcIiwgbnVsbCwgXCIyXCIsIFwiM1wiXSxcbiAgfSxcbn0pO1xuXG5jb25zdCBUT05FX0NPTlZFUlRfVEFCTEUgPSBPYmplY3QuZnJlZXplKHtcbiAgLy8gaVxuICBcIlxcdTAwNjlcIjogW1wiXFx1MDEyQlwiLCBcIlxcdTAwRUNcIiwgXCJcXHUwMEVFXCIsIFwiXFx1MDBFRFwiLCBcIlxcdTAxRDBcIl0sXG4gIC8vIGVcbiAgXCJcXHUwMDY1XCI6IFtcIlxcdTAxMTNcIiwgXCJcXHUwMEU4XCIsIFwiXFx1MDBFQVwiLCBcIlxcdTAwRTlcIiwgXCJcXHUwMTFCXCJdLFxuICAvLyDJm1xuICBcIlxcdTAyNUJcIjogW1xuICAgIFwiXFx1MDI1QlxcdTAzMDRcIixcbiAgICBcIlxcdTAyNUJcXHUwMzAwXCIsXG4gICAgXCJcXHUwMjVCXFx1MDMwMlwiLFxuICAgIFwiXFx1MDI1QlxcdTAzMDFcIixcbiAgICBcIlxcdTAyNUJcXHUwMzBDXCIsXG4gIF0sXG4gIC8vIMqJXG4gIFwiXFx1MDI4OVwiOiBbXG4gICAgXCJcXHUwMjg5XFx1MDMwNFwiLFxuICAgIFwiXFx1MDI4OVxcdTAzMDBcIixcbiAgICBcIlxcdTAyODlcXHUwMzAyXCIsXG4gICAgXCJcXHUwMjg5XFx1MDMwMVwiLFxuICAgIFwiXFx1MDI4OVxcdTAzMENcIixcbiAgXSxcbiAgLy8gyZlcbiAgXCJcXHUwMjU5XCI6IFtcbiAgICBcIlxcdTAyNTlcXHUwMzA0XCIsXG4gICAgXCJcXHUwMjU5XFx1MDMwMFwiLFxuICAgIFwiXFx1MDI1OVxcdTAzMDJcIixcbiAgICBcIlxcdTAyNTlcXHUwMzAxXCIsXG4gICAgXCJcXHUwMjU5XFx1MDMwQ1wiLFxuICBdLFxuICAvLyBhXG4gIFwiXFx1MDA2MVwiOiBbXCJcXHUwMTAxXCIsIFwiXFx1MDBFMFwiLCBcIlxcdTAwRTJcIiwgXCJcXHUwMEUxXCIsIFwiXFx1MDFDRVwiXSxcbiAgLy8gdVxuICBcIlxcdTAwNzVcIjogW1wiXFx1MDE2QlwiLCBcIlxcdTAwRjlcIiwgXCJcXHUwMEZCXCIsIFwiXFx1MDBGQVwiLCBcIlxcdTAxRDRcIl0sXG4gIC8vIG9cbiAgXCJcXHUwMDZGXCI6IFtcIlxcdTAxNERcIiwgXCJcXHUwMEYyXCIsIFwiXFx1MDBGNFwiLCBcIlxcdTAwRjNcIiwgXCJcXHUwMUQyXCJdLFxuICAvLyDJlFxuICBcIlxcdTAyNTRcIjogW1xuICAgIFwiXFx1MDI1NFxcdTAzMDRcIixcbiAgICBcIlxcdTAyNTRcXHUwMzAwXCIsXG4gICAgXCJcXHUwMjU0XFx1MDMwMlwiLFxuICAgIFwiXFx1MDI1NFxcdTAzMDFcIixcbiAgICBcIlxcdTAyNTRcXHUwMzBDXCIsXG4gIF0sXG4gIC8vIMO8XG4gIFwiXFx1MDBGQ1wiOiBbXCJcXHUwMUQ2XCIsIFwiXFx1MDFEQ1wiLCBcIlwiLCBcIlxcdTAxRDhcIiwgXCJcXHUwMURBXCJdLFxufSk7XG5cbmNvbnN0IFRPTkVfU1lNQk9MUyA9IE9iamVjdC5mcmVlemUoW1xuICBcIlxcdTAzMDRcIixcbiAgXCJcXHUwMzAwXCIsXG4gIFwiXFx1MDMwMlwiLFxuICBcIlxcdTAzMDFcIixcbiAgXCJcXHUwMzBDXCIsXG5dKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVG9uZWxldHRlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGlucHV0RWxlbWVudCxcbiAgICBzZXR0aW5ncyA9IHsgbGFuZzogXCJcIiwgcGhvbmV0aWNTeW1ib2xzOiBudWxsLCB0b25lS2V5czogbnVsbCB9XG4gICkge1xuICAgIGlmICghaW5wdXRFbGVtZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJgaW5wdXRFbGVtZW50YCBtdXN0IGJlIGdpdmVuXCIpO1xuICAgIH1cbiAgICBpZiAoc2V0dGluZ3MubGFuZyA9PT0gXCJcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYHNldHRpbmdzLmxhbmdgIG11c3QgYmUgZ2l2ZW5cIik7XG4gICAgfVxuICAgIGlmICghW1widGhcIiwgXCJjblwiXS5pbmNsdWRlcyhzZXR0aW5ncy5sYW5nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYHNldHRpbmdzLmxhbmdgIG11c3QgYmUgJ3RoJyBvciAnY24nXCIpO1xuICAgIH1cblxuICAgIHRoaXMuaW5wdXRFbGVtZW50ID0gaW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IHBob25ldGljU3ltYm9scyA9XG4gICAgICBzZXR0aW5ncy5waG9uZXRpY1N5bWJvbHMgPz8gTEFOR19TRVRUSU5HU1tzZXR0aW5ncy5sYW5nXS5waG9uZXRpY1N5bWJvbHM7XG4gICAgY29uc3QgdG9uZUtleXMgPSBzZXR0aW5ncy50b25lS2V5cyA/PyBMQU5HX1NFVFRJTkdTW3NldHRpbmdzLmxhbmddLnRvbmVLZXlzO1xuICAgIHRoaXMuX19rZXlUb0NhbGxiYWNrcyA9IHtcbiAgICAgIC4uLnRoaXMuX19jcmVhdGVQaG9uZXRpY1N5bWJvbENhbGxiYWNrcyhwaG9uZXRpY1N5bWJvbHMpLFxuICAgICAgLi4udGhpcy5fX2NyZWF0ZVRvbmVDYWxsYmFja3ModG9uZUtleXMpLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgZ2V0IHZlcnNpb24oKSB7XG4gICAgcmV0dXJuIHBhY2thZ2VKc29uLnZlcnNpb247XG4gIH1cblxuICBvYnNlcnZlKCkge1xuICAgIHRoaXMuX19vbktleURvd24uX19ib3VuZCA9IChlKSA9PiB0aGlzLl9fb25LZXlEb3duKGUpO1xuICAgIHRoaXMuaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX19vbktleURvd24uX19ib3VuZCk7XG4gIH1cblxuICBvZmYoKSB7XG4gICAgdGhpcy5pbnB1dEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fX29uS2V5RG93bi5fX2JvdW5kKTtcbiAgfVxuXG4gIGFkZFRvbmUodG9uZU51bWJlciwgcHJlc3NlZEtleSkge1xuICAgIGlmICh0aGlzLl9faXNDb252ZXJ0YWJsZSh0aGlzLl9fcHJldmlvdXNDaGFyYWN0ZXIpKSB7XG4gICAgICB0aGlzLl9faW5zZXJ0VG9uZSh0aGlzLl9fY29udmVydFRvVG9uZSh0b25lTnVtYmVyKSk7XG4gICAgfSBlbHNlIGlmIChwcmVzc2VkS2V5KSB7XG4gICAgICB0aGlzLl9faW5zZXJ0KHByZXNzZWRLZXkpO1xuICAgIH1cbiAgfVxuXG4gIF9fY3JlYXRlUGhvbmV0aWNTeW1ib2xDYWxsYmFja3MocGhvbmV0aWNTeW1ib2xzKSB7XG4gICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHBob25ldGljU3ltYm9scykucmVkdWNlKChhY2N1bSwgW2tleSwgc3ltYm9sXSkgPT4ge1xuICAgICAgYWNjdW1ba2V5XSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5fX2luc2VydChzeW1ib2wpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBhY2N1bTtcbiAgICB9LCB7fSk7XG4gIH1cblxuICBfX2NyZWF0ZVRvbmVDYWxsYmFja3ModG9uZUtleXMpIHtcbiAgICByZXR1cm4gdG9uZUtleXMucmVkdWNlKChhY2N1bSwga2V5LCBpKSA9PiB7XG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIGFjY3VtW2tleV0gPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5hZGRUb25lKGksIGtleSk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjdW07XG4gICAgfSwge30pO1xuICB9XG5cbiAgX19vbktleURvd24oZSkge1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5fX2tleVRvQ2FsbGJhY2tzW2Uua2V5XTtcbiAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgX19pbnNlcnQodGV4dCkge1xuICAgIHZhciBhdCA9IHRoaXMuX19jdXJzb3JQb3NpdGlvbjtcbiAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9XG4gICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5zbGljZSgwLCBhdCkgK1xuICAgICAgdGV4dCArXG4gICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5zbGljZShhdCk7XG4gICAgdGhpcy5fX3NldEN1cnNvcihhdCArIHRleHQubGVuZ3RoKTtcbiAgfVxuXG4gIF9faW5zZXJ0VG9uZSh0b25lKSB7XG4gICAgdGhpcy5fX2JhY2tzcGFjZSgpO1xuICAgIHRoaXMuX19pbnNlcnQodG9uZSk7XG4gIH1cblxuICBfX2JhY2tzcGFjZSgpIHtcbiAgICBjb25zdCBmcm9tID0gdGhpcy5fX2N1cnNvclBvc2l0aW9uO1xuICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuX19jYWxjQlNMZW5ndGgoZnJvbSwgdGhpcy5fX3ByZXZpb3VzQ2hhcmFjdGVyKTtcbiAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9XG4gICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5zbGljZSgwLCBmcm9tIC0gbGVuZ3RoKSArXG4gICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5zbGljZShmcm9tKTtcbiAgICB0aGlzLl9fc2V0Q3Vyc29yKGZyb20gLSBsZW5ndGgpO1xuICB9XG5cbiAgX19jYWxjQlNMZW5ndGgocG9zaXRpb24sIGNoYXJhY3Rlcikge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZVxuICAgICAgICAuc3Vic3RyaW5nKDAsIHBvc2l0aW9uKVxuICAgICAgICAuc3BsaXQoXCJcIilcbiAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAubWFwKHRoaXMuX19yZW1vdmVUb25lKVxuICAgICAgICAuaW5kZXhPZihjaGFyYWN0ZXIpICsgMVxuICAgICk7XG4gIH1cblxuICBnZXQgX19jdXJzb3JQb3NpdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dEVsZW1lbnQuc2VsZWN0aW9uRW5kO1xuICB9XG5cbiAgZ2V0IF9fcHJldmlvdXNDaGFyYWN0ZXIoKSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLl9fY3Vyc29yUG9zaXRpb247XG4gICAgY29uc3QgcHJldkNoYXIgPSB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5jaGFyQXQocG9zaXRpb24gLSAxKTtcbiAgICBpZiAocHJldkNoYXIgPT09IFwiXCIpIHJldHVybiBwcmV2Q2hhcjtcbiAgICAvLyBTa2lwIGlmIHRoZSBwcmV2aW91cyBjaGFyYWN0ZXIgaXMganVzdCBhIHRvbmUgc3ltYm9sXG4gICAgaWYgKHRoaXMuX19pc1RvbmUocHJldkNoYXIpKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUuY2hhckF0KHBvc2l0aW9uIC0gMik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlVG9uZShwcmV2Q2hhcik7XG4gIH1cblxuICBfX3NldEN1cnNvcihwb3NpdGlvbikge1xuICAgIHRoaXMuaW5wdXRFbGVtZW50LmZvY3VzKCk7XG4gICAgdGhpcy5pbnB1dEVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmlucHV0RWxlbWVudC5zZWxlY3Rpb25FbmQgPVxuICAgICAgcG9zaXRpb247XG4gIH1cblxuICBfX2lzVG9uZShjaGFyYWN0ZXIpIHtcbiAgICByZXR1cm4gVE9ORV9TWU1CT0xTLmluZGV4T2YoY2hhcmFjdGVyKSA+IC0xO1xuICB9XG5cbiAgX19pc0NvbnZlcnRhYmxlKGNoYXJhY3Rlcikge1xuICAgIHJldHVybiBUT05FX0NPTlZFUlRfVEFCTEVbY2hhcmFjdGVyXSAhPT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgX19jb252ZXJ0VG9Ub25lKHRvbmVOdW1iZXIpIHtcbiAgICByZXR1cm4gVE9ORV9DT05WRVJUX1RBQkxFW3RoaXMuX19wcmV2aW91c0NoYXJhY3Rlcl1bdG9uZU51bWJlcl07XG4gIH1cblxuICBfX3JlbW92ZVRvbmUoY2hhcmFjdGVyKSB7XG4gICAgZm9yIChjb25zdCB2b3dlbCBpbiBUT05FX0NPTlZFUlRfVEFCTEUpIHtcbiAgICAgIGlmIChUT05FX0NPTlZFUlRfVEFCTEVbdm93ZWxdLmluZGV4T2YoY2hhcmFjdGVyKSA+IC0xKSB7XG4gICAgICAgIHJldHVybiB2b3dlbDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoYXJhY3RlcjtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInBhY2thZ2VKc29uIiwicmVxdWlyZSIsIkxBTkdfU0VUVElOR1MiLCJPYmplY3QiLCJmcmVlemUiLCJ0aCIsInBob25ldGljU3ltYm9scyIsIlciLCJVIiwiRSIsIk8iLCJOIiwidG9uZUtleXMiLCJjbiIsIlRPTkVfQ09OVkVSVF9UQUJMRSIsIlRPTkVfU1lNQk9MUyIsIlRvbmVsZXR0ZXIiLCJjb25zdHJ1Y3RvciIsImlucHV0RWxlbWVudCIsInNldHRpbmdzIiwibGFuZyIsIkVycm9yIiwiaW5jbHVkZXMiLCJfX2tleVRvQ2FsbGJhY2tzIiwiX19jcmVhdGVQaG9uZXRpY1N5bWJvbENhbGxiYWNrcyIsIl9fY3JlYXRlVG9uZUNhbGxiYWNrcyIsInZlcnNpb24iLCJvYnNlcnZlIiwiX19vbktleURvd24iLCJfX2JvdW5kIiwiZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvZmYiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiYWRkVG9uZSIsInRvbmVOdW1iZXIiLCJwcmVzc2VkS2V5IiwiX19pc0NvbnZlcnRhYmxlIiwiX19wcmV2aW91c0NoYXJhY3RlciIsIl9faW5zZXJ0VG9uZSIsIl9fY29udmVydFRvVG9uZSIsIl9faW5zZXJ0IiwiZW50cmllcyIsInJlZHVjZSIsImFjY3VtIiwia2V5Iiwic3ltYm9sIiwiaSIsImNhbGxiYWNrIiwicHJldmVudERlZmF1bHQiLCJ0ZXh0IiwiYXQiLCJfX2N1cnNvclBvc2l0aW9uIiwidmFsdWUiLCJzbGljZSIsIl9fc2V0Q3Vyc29yIiwibGVuZ3RoIiwidG9uZSIsIl9fYmFja3NwYWNlIiwiZnJvbSIsIl9fY2FsY0JTTGVuZ3RoIiwicG9zaXRpb24iLCJjaGFyYWN0ZXIiLCJzdWJzdHJpbmciLCJzcGxpdCIsInJldmVyc2UiLCJtYXAiLCJfX3JlbW92ZVRvbmUiLCJpbmRleE9mIiwic2VsZWN0aW9uRW5kIiwicHJldkNoYXIiLCJjaGFyQXQiLCJfX2lzVG9uZSIsImZvY3VzIiwic2VsZWN0aW9uU3RhcnQiLCJ1bmRlZmluZWQiLCJ2b3dlbCJdLCJzb3VyY2VSb290IjoiIn0=